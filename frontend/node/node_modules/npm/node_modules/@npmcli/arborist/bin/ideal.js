const Arborist = require('@npmcli/arborist')

const printTree = require('@npmcli/arborist/bin/lib/print-tree.js')

module.exports = (options, time) => new Arborist(options)
  .buildIdealTree(options)
  .then(time)
  .then(async ({ timing, result: tree }) => {
    printTree(tree)
    if (tree.meta && options.save) {
      await tree.meta.save()
    }
    return `resolved ${tree.inventory.size} deps in ${timing.seconds}`
  })
